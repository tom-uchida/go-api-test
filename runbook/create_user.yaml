desc: ユーザー作成APIのテスト

runners:
  req: http://localhost:8080
  dsn: spanner://test-project/test-instance/test-db

vars:
  tableName: "Users"
  userNames: ["test-name-1", "test-name-2"]

steps:
  create-user:
    desc: "ユーザー作成"
    loop: len(vars.userNames)
    req:
      /create-user:
        post:
          body:
            application/json:
              name: "{{ vars.userNames[i] }}"
    test: |
      current.res.status == 200
    dump:
      expr: current.res.body

  select-table:
    desc: "Usersテーブルの確認"
    dsn:
      query: |
        SELECT *
        FROM "{{ vars.tableName }}"
    test: |
      len(current.rows) == len(vars.userNames)
    dump:
      expr: current.rows